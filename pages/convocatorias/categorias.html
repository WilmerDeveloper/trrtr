<!DOCTYPE html>
<html lang="en">

    <head>

        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">

        <title>::Categorias::</title>

        <!-- Bootstrap Core CSS -->
        <link href="../../vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">

        <!-- MetisMenu CSS -->
        <link href="../../vendor/metisMenu/metisMenu.min.css" rel="stylesheet">

        <!-- Custom CSS -->
        <link href="../../dist/css/sb-admin-2.css" rel="stylesheet">

        <!-- Custom Fonts -->
        <link href="../../vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">

        <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
        <![endif]-->

        <!-- validator bootstrap -->
        <link href='../../dist/libraries/bootstrap-validator/bootstrapValidator.css' rel='stylesheet'>                

        <!-- DataTables Select CSS -->
        <link href="../../dist/libraries/datatables-select/select.bootstrap.css" rel="stylesheet">
        <!-- DataTables Responsive CSS -->
        <link href="../../dist/libraries/datatables-responsive/dataTables.responsive.css" rel="stylesheet">        

        <!-- Bootstrap animate -->
        <link href="../../dist/libraries/bootstrap-notify-3.1.3/animate.css" rel="stylesheet" type="text/css"/>

        <!-- Text area editor html -->
        <link type="text/css" rel="stylesheet" href="../../dist/libraries/jQuery-TE_v.1.4.0/jquery-te-1.4.0.css">
        
        <!-- css principales de la aplicacion -->
        <link href="../../dist/css/main.css" rel="stylesheet" type="text/css"/>
    </head>

    <body>
        <!-- Modal que se activa cuando se realiza cualquier peticion ajax -->
        <div class="modal fade" id="my_loader" role="dialog">
            <div class="modal-dialog">    
                <div class="loader" style="margin: 0 auto;"></div>             
            </div>
        </div>
        <div id="wrapper">

            <!-- Navigation -->
            <nav id="menu_principal" class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
            </nav>

            <div id="page-wrapper">
                <div class="row">                    
                    <div class="col-lg-12">                         
                        <h1 class="page-header">Categoriás</h1>
                    </div>
                    <div class="panel-body" style="text-align: right">                    
                        <button type="button" class="btn btn-default btn-circle btn-lg regresar" onclick=""><i class="fa fa-arrow-left"></i></button>
                        <button type="button" class="btn btn-primary btn-circle btn-lg regresar" onclick="'"><i class="fa fa-list"></i></button>
                        <button type="button" class="btn btn-success btn-circle btn-lg" data-toggle="modal" data-target="#nueva_convocatoria" ><i class="fa fa-file-o"></i></button>
                    </div>
                    <!-- /.col-lg-12 -->
                </div>
                <div class="modal fade" id="nueva_convocatoria">
                    <div class="modal-dialog">
                        <div class="modal-content">

                            <!-- cabecera del diálogo -->
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h4 class="modal-title">Categoría</h4>                                                    
                            </div>

                            <!-- cuerpo del diálogo -->
                            <div class="modal-body">
                                <form id="form_nuevo_convocatoria" action="" class="form_nuevo_convocatoria" role="form" method="post">
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="form-group">
                                                <label>Nombre de la categoría <span class="icono_requerido">*</span></label>
                                                <input id="nuevo_nombre" type="text" name="nombre" class="form-control">                                                
                                            </div>                                                                                                                                                                                                                                                                                                        
                                        </div>
                                        <div class="col-lg-12">
                                            <div class="form-group">
                                                <label>Descripción corta de la categoría <span class="icono_requerido">*</span></label>
                                                <textarea id="nuevo_descripcion" name="descripcion" class="form-control textarea_html" rows="3"></textarea>                                                
                                            </div>                                                                                                                                                                                                                                                                                                        
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="form-group">
                                                <label>¿La convocatoria se presenta a través de seudónimo?</label>
                                                <select id='nuevo_seudonimo' name="seudonimo" class="form-control" >                                                    
                                                    <option value="true">Sí</option>
                                                    <option value="false" selected="selected">No</option>
                                                </select>                                                
                                            </div>                                                                                                                                                                                                                                                                                                        
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-12" style="text-align: right">
                                            <input type="hidden" id="id" name="convocatoria" />
                                            <button type="submit" class="btn btn-default">Guardar</button>                                            
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal fade" id="editar_convocatoria">
                    <div class="modal-dialog">
                        <div class="modal-content">

                            <!-- cabecera del diálogo -->
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h4 class="modal-title">Categoría</h4>                                                    
                            </div>

                            <!-- cuerpo del diálogo -->
                            <div class="modal-body" style="height: 450px; overflow-y: auto;">
                                <form id="form_edit_convocatoria" action="" class="form_edit_convocatoria" role="form" method="post">
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="form-group">
                                                <label>Nombre de la categoría <span class="icono_requerido">*</span></label>
                                                <input type="text" name="nombre" class="form-control">                                                
                                            </div>                                                                                                                                                                                                                                                                                                        
                                        </div>
                                        <div class="col-lg-12">
                                            <div class="form-group">
                                                <label>Descripción corta de la categoría <span class="icono_requerido">*</span></label>
                                                <textarea id="descripcion" name="descripcion" class="form-control textarea_html" rows="3"></textarea>                                                
                                            </div>                                                                                                                                                                                                                                                                                                        
                                        </div>
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="form-group">
                                                <label>¿La convocatoria se presenta a través de seudónimo?</label>
                                                <select id='seudonimo' name="seudonimo" class="form-control" >                                                    
                                                    <option value="true">Sí</option>
                                                    <option value="false" selected="selected">No</option>
                                                </select>                                                
                                            </div>                                                                                                                                                                                                                                                                                                        
                                        </div>
                                    </div>    
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div id="quienes_pueden_participar" class="form-group" style="text-align: center">

                                            </div>                                                                                                                                                                                                                                                                                                        
                                        </div>                                                                                                                                                                                                                                                                                                       
                                    </div>                                
                                    <h3>Información general de los recursos a otorgar</h3>                                    
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <div class="form-group">
                                                <label>Tipo de estímulo <span class="icono_requerido">*</span></label>
                                                <select class="form-control" id='tipo_estimulo' name="tipo_estimulo" >                                                    
                                                    <option value="">:: Seleccionar ::</option>
                                                </select>                                                
                                            </div>                                                                                                                                                                                                                                                                                                        
                                        </div>                                         
                                        <div class="col-lg-6">
                                            <div class="form-group">
                                                <label>Número de estímulos</label>
                                                <input type="text" name="numero_estimulos" class="form-control">                                                
                                            </div>                                                                                                                                                                                                                                                                                                        
                                        </div>                                         
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <div class="form-group">
                                                <label>Valor total de recursos que entregará la convocatoria <span class="icono_requerido">*</span></label>
                                                <input type="text" name="valor_total_estimulos" class="form-control">                                                
                                            </div>                                                                                                                                                                                                                                                                                                        
                                        </div>                                         
                                        <div class="col-lg-6">
                                            <div class="form-group">
                                                <label>Bolsa Concursable</label>
                                                <select id='bolsa_concursable' name="bolsa_concursable" class="form-control" >                                                    
                                                    <option value="true" >Sí</option>
                                                    <option value="false" selected="selected">No</option>
                                                </select>                                                
                                            </div>                                                                                                                                                                                                                                                                                                        
                                        </div>                                         
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="form-group">
                                                <label>Descripción de la distribución de la bolsa</label>
                                                <textarea disabled="disabled" id="descripcion_bolsa" name="descripcion_bolsa" class="form-control class_bolsa_concursable" rows="3"></textarea>                                                
                                            </div>                                                                                                                                                                                                                                                                                                        
                                        </div>                                          
                                    </div>

                                    <div class="row">
                                        <div class="col-lg-6">
                                            <div class="form-group">
                                                <label>&nbsp;</label><br/>
                                                <button disabled="disabled" type="button" class="btn btn-primary class_bolsa_concursable" data-toggle="modal" data-target="#distribucion_bolsa_modal" >Abrir ventana de distribución de la bolsa</button>
                                            </div>                                                                                                                                                                                                                                                                                                      
                                        </div>                                         
                                        <div class="col-lg-6">
                                            <div class="form-group">
                                                <label>&nbsp;</label><br/>
                                                <button disabled="disabled" type="button" class="btn btn-primary class_tipo_estimulo" data-toggle="modal" data-target="#detalle_especie_modal" >Abrir ventana de detalle especie</button>
                                            </div>                                                                                                                                                                                                                                                                                                       
                                        </div>                                         
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="form-group text-center">
                                                <label>&nbsp;</label><br/>
                                                <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#perfiles_participantes_modal" >Abrir ventana de perfiles de los participantes</button>
                                            </div>                                                                                                                                                                                                                                                                                                      
                                        </div>                                                                                 
                                    </div>
                                    
                                    <div class="row">
                                        <div class="col-lg-12" style="text-align: right">
                                            <input type="hidden" id="convocatoria" name="convocatoria" />
                                            <input type="hidden" id="id_categoria" name="id" />
                                            <button type="submit" class="btn btn-default">Guardar</button>                                            
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal fade" id="perfiles_participantes_modal">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <!-- cabecera del diálogo -->
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h4 class="modal-title">Perfiles de los participantes</h4>                                                    
                            </div>

                            <!-- cuerpo del diálogo -->
                            <div class="modal-body" style="height: 450px; overflow-y: auto;">
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="form-group">
                                                <label>Tipo de participante</label><br/>
                                                <span id="tipo_participante_cp"></span>
                                            </div>                                                                                                                                                                                                                                                                                                        
                                        </div>                                                                                                                                                                                                                                                                                                                        
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="form-group">
                                                <label>Descripción</label>
                                                <textarea id="descripcion_cp" name="descripcion_cp" class="form-control textarea_html" rows="3"></textarea>
                                            </div>                                                                                                                                                                                                                                                                                                        
                                        </div>                                                                                                                                                   
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-12" style="text-align: right">                                                        
                                            <input type="hidden" id="id_cp" name="id_cp" />
                                            <button id="guardar_cp" type="submit" class="btn btn-default">Guardar</button>
                                        </div>
                                    </div>
                                    <br/>
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="panel panel-default">
                                                <div class="panel-body">
                                                    <div class="table-responsive">
                                                        <table class="table">
                                                            <thead>
                                                                <tr>
                                                                    <th>Tipo de participante</th>                                                                                                                                                                        
                                                                    <th>¿Activo?</th>
                                                                    <th>Acciones</th>
                                                                </tr>
                                                            </thead>
                                                            <tbody id="tbody_tipos_participantes">

                                                            </tbody>
                                                        </table>
                                                    </div>
                                                    <!-- /.table-responsive -->
                                                </div>
                                                <!-- /.panel-body -->
                                            </div>
                                        </div>
                                    </div>                                                
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal fade" id="distribucion_bolsa_modal">
                    <div class="modal-dialog">
                        <div class="modal-content">

                            <!-- cabecera del diálogo -->
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h4 class="modal-title">Distribución de la bolsa</h4>                                                    
                            </div>

                            <!-- cuerpo del diálogo -->
                            <div class="modal-body" style="height: 450px; overflow-y: auto;">
                                <form id="form_validator_bolsa" action="" class="form_validator_bolsa" role="form" method="post">
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <div class="form-group">
                                                <label>Número de estímulos a otorgar</label>
                                                <input type="text" name="orden" class="form-control">                                                
                                            </div>                                                                                                                                                                                                                                                                                                        
                                        </div>                                                                                                            
                                        <div class="col-lg-6">
                                            <div class="form-group">
                                                <label>Valor individual por estímulo</label>
                                                <input type="text" name="valor_recurso" class="form-control">                                                
                                            </div>                                                                                                                                                                                                                                                                                                        
                                        </div>                                                                                                                                                    
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-12" style="text-align: right">   
                                            <input type="hidden" id="id_bolsa" name="id" />
                                            <input type="hidden" name="tipo_recurso" value="Bolsa"/>
                                            <button type="submit" class="btn btn-default">Guardar</button>
                                        </div>
                                    </div>
                                    <br/>
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="panel panel-default">
                                                <div class="panel-body">
                                                    <div class="table-responsive">
                                                        <table class="table">
                                                            <thead>
                                                                <tr>
                                                                    <th>Número de estímulos a otorgar</th>
                                                                    <th>Valor individual por estímulo</th>                                                                                    
                                                                    <th>¿Activo?</th>                                                                                    
                                                                    <th>Acciones</th>                                                                                    
                                                                </tr>
                                                            </thead>
                                                            <tbody id="tbody_distribuciones_bolsas">

                                                            </tbody>
                                                        </table>
                                                    </div>
                                                    <!-- /.table-responsive -->
                                                </div>
                                                <!-- /.panel-body -->
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- ME QUEDE EN EL FUNCIONANIMENTO DE LOS MODAL OJO WILLIAM-->
                <div class="modal fade" id="detalle_especie_modal">
                    <div class="modal-dialog">
                        <div class="modal-content">
                            <!-- cabecera del diálogo -->
                            <div class="modal-header">
                                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                <h4 class="modal-title">Detalle especie</h4>                                                    
                            </div>

                            <!-- cuerpo del diálogo -->
                            <div class="modal-body" style="height: 450px; overflow-y: auto;">
                                <form id="form_validator_especie" class="form_validator_especie" action="" role="form" method="post">
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <div class="form-group">
                                                <label>Orden</label>
                                                <input type="text" name="orden" class="form-control">                                                
                                            </div>                                                                                                                                                                                                                                                                                                        
                                        </div>                                                                                                            
                                        <div class="col-lg-6">
                                            <div class="form-group">
                                                <label>Tipo de estímulo no pecuniario</label>
                                                <select id='recurso_no_pecuniario' name="recurso_no_pecuniario" class="form-control" >                                                    
                                                    <option value="">:: Seleccionar ::</option>
                                                </select>                                                                
                                            </div>                                                                                                                                                                                                                                                                                                        
                                        </div>                                                                                                                                                    
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <div class="form-group">
                                                <label>Valoración del recurso no pecuniario</label>
                                                <input type="text" name="valor_recurso" class="form-control">                                                
                                            </div>                                                                                                                                                                                                                                                                                                        
                                        </div>                                                                                                            
                                        <div class="col-lg-6">
                                            <div class="form-group">
                                                <label>Descripción del recurso no pecuniario</label>
                                                <input type="text" name="descripcion_recurso" class="form-control">                                                                                                                
                                            </div>                                                                                                                                                                                                                                                                                                        
                                        </div>                                                                                                                                                    
                                    </div>
                                    <div class="row">
                                        <div class="col-lg-12" style="text-align: right">   
                                            <input type="hidden" id="id_especie" name="id" />
                                            <input type="hidden" name="tipo_recurso" value="Especie"/>
                                            <button type="submit" class="btn btn-default">Guardar</button>
                                        </div>
                                    </div>
                                    <br/>
                                    <div class="row">
                                        <div class="col-lg-12">
                                            <div class="panel panel-default">
                                                <div class="panel-body">
                                                    <div class="table-responsive">
                                                        <table class="table">
                                                            <thead>
                                                                <tr>
                                                                    <th>Orden</th>
                                                                    <th>Tipo de estímulo no pecuniario</th>                                                                                    
                                                                    <th>Valoración de recursos no pecuniarios</th>                                                                                                                                                                        
                                                                    <th>¿Activo?</th>                                                                                    
                                                                    <th>Acciones</th>     
                                                                </tr>
                                                            </thead>
                                                            <tbody id="tbody_distribuciones_especie">

                                                            </tbody>
                                                        </table>
                                                    </div>
                                                    <!-- /.table-responsive -->
                                                </div>
                                                <!-- /.panel-body -->
                                            </div>
                                        </div>
                                    </div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
                
                
                <!-- /.row -->
                <div class="row">
                    <div class="col-lg-12">
                        <div class="panel panel-default">
                            <div class="panel-heading">
                                Categorias registradas
                            </div>                             
                            <div class="panel-body">
                                <div class="row">
                                    <div class="col-lg-12">
                                        <table id="table_categorias" class="table_categorias table">
                                            <thead>
                                                <tr>
                                                    <th>Nombre</th>
                                                    <th>Descripción corta de la categoria</th>
                                                    <th>¿Activo?</th>
                                                    <th>Acciones</th>
                                                </tr>
                                            </thead>
                                        </table>
                                    </div>
                                </div>
                                <!-- /.row (nested) -->
                            </div>
                            <!-- /.panel-body -->
                        </div>
                        <!-- /.panel -->
                    </div>
                    <!-- /.col-lg-12 -->
                </div>                                    
            </div>
            <!-- /#page-wrapper -->

        </div>
        <!-- /#wrapper -->

        <!-- jQuery -->
        <script src="../../vendor/jquery/jquery.min.js"></script>

        <!-- Bootstrap Core JavaScript -->
        <script src="../../vendor/bootstrap/js/bootstrap.min.js"></script>

        <!-- Metis Menu Plugin JavaScript -->
        <script src="../../vendor/metisMenu/metisMenu.min.js"></script>

        <!-- Custom Theme JavaScript -->
        <script src="../../dist/js/sb-admin-2.js"></script>

        <!-- validator bootstrap -->
        <script src='../../dist/libraries/bootstrap-validator/bootstrapValidator.min.js'></script>
        <script src='../../dist/libraries/bootstrap-validator/language/es_ES.js'></script>

        <!-- DataTables -->
        <script src="../../dist/libraries/datatables/js/jquery.dataTables.min.js"></script>
        <script src="../../dist/libraries/datatables-plugins/dataTables.bootstrap.min.js"></script>
        <script src="../../dist/libraries/datatables-responsive/dataTables.responsive.js"></script>
        <script src="../../dist/libraries/datatables-select/dataTables.select.min.js"></script>

        <!-- Bootstrap Notify-->
        <script src="../../dist/libraries/bootstrap-notify-3.1.3/bootstrap-notify.min.js" type="text/javascript"></script>

        <!-- funcionalidades principales -->
        <script src='../../dist/js/main.js'></script>
        <script src='../../dist/js/jquery.loadJSON.js'></script>
        <script src='../../dist/js/verificar_token.js'></script>
        
        <!-- Text area editor html -->
        <script type="text/javascript" src="../../dist/libraries/jQuery-TE_v.1.4.0/jquery-te-1.4.0.min.js" charset="utf-8"></script>

        <script>
            $(document).ready(function () {

                //Verifico si el token exite en el cliente y verifico que el token este activo en el servidor                
                var token_actual = getLocalStorage(name_local_storage);

                //Verifico si el token esta vacio, para enviarlo a que ingrese de nuevo
                if ($.isEmptyObject(token_actual)) {
                    location.href = '../../index.html?msg=Su sesión ha expirado, por favor vuelva a ingresar.&msg_tipo=danger';
                } 
                else
                {

                    //Verifica si el token actual tiene acceso de lectura
                    permiso_lectura(token_actual, "Convocatorias");

                    //Realizo la peticion para cargar el formulario
                    if ($("#id").val() != "") {
                        
                        //Establesco los text area html
                        $('.textarea_html').jqte();
                        
                        //Limpio el formulario de las categorias
                        $('#nueva_convocatoria').on('hidden.bs.modal', function () {                            
                            $("#nuevo_descripcion").jqteVal('');
                            $("#nuevo_nombre").val("");                            
                            $("#nuevo_seudonimo option[value='false']").prop("selected", true);
                        })
                        
                        $('#editar_convocatoria').on('hidden.bs.modal', function () {                            
                            $("#nuevo_descripcion").jqteVal('');
                            $("#nuevo_nombre").val("");                            
                            $("#nuevo_seudonimo option[value='false']").prop("selected", true);
                        })
                                    
                        //Realizo la peticion para cargar el formulario
                        $.ajax({
                            type: 'GET',
                            data: {"token": token_actual.token, "id": $("#id").attr('value')},
                            url: url_pv + 'Convocatorias/search/'
                        }).done(function (data) {
                            if (data == 'error_metodo')
                            {
                                notify("danger", "ok", "Convocatorias:", "Se registro un error en el método, comuníquese con la mesa de ayuda soporte.convocatorias@scrd.gov.co");
                            } else
                            {
                                if (data == 'error')
                                {
                                    location.href = 'list.html?msg=Debe seleccionar una convocatoria, para poder continuar.&msg_tipo=danger';
                                } else
                                {
                                    var json = JSON.parse(data);

                                    if (typeof json.convocatoria.id === 'number') {
                                        
                                        $(".regresar").attr("onclick","location.href='update.html?id="+$("#id").attr('value')+"'");
                                        
                                        //Valido si la convocatoria tiene categorias
                                        if(json.convocatoria.tiene_categorias==false)
                                        {
                                           notify("danger", "ok", "Convocatorias:", "La convocatoria no tiene habilitada la opción de crear categorías, para habilitarla debe seleccionar (Sí) en el campo ¿Tiene categorias? de la seccion Información General."); 
                                        }                                                                                                                        
                                    }
                                }
                            }
                        });
                        
                        
                        $('#detalle_especie_modal').on('hidden.bs.modal', function () {
                            $("#id_especie").attr("value","");
                            $("#form_validator_especie").bootstrapValidator('disableSubmitButtons', false).bootstrapValidator('resetForm', true);
                            $("#form_validator_especie").data('bootstrapValidator').resetForm();
                        });
                        
                        $('#distribucion_bolsa_modal').on('hidden.bs.modal', function () {
                            $("#id_bolsa").attr("value","");                                    
                            $("#form_validator_bolsa").bootstrapValidator('disableSubmitButtons', false).bootstrapValidator('resetForm', true);
                            $("#form_validator_bolsa").data('bootstrapValidator').resetForm();
                        });
                        
                        
                        //Cargar datos de la tabla de categorias
                        cargar_tabla(token_actual);
                        
                    } 
                    else
                    {
                        location.href = 'list.html?msg=Debe seleccionar una convocatoria, para poder continuar.&msg_tipo=danger';
                    }
                    
                    //guardar registro de convocatoria perfil participante
                    $("#guardar_cp").click(function () {
                        if ($("#id_cp").val() != "") {
                            //Realizo la peticion con el fin de editar el registro del perfil de la convocatoria
                            $.ajax({
                                type: 'PUT',
                                url: url_pv + 'Convocatoriasparticipantes/edit/' + $("#id_cp").attr('value'),
                                data: "descripcion_perfil="+ $("#descripcion_cp").val() + "&modulo=Convocatorias&token=" + token_actual.token
                            }).done(function (result) {
                                if (result == 'error')
                                {
                                    notify("danger", "ok", "Convocatorias:", "Se registro un error, comuníquese con la mesa de ayuda soporte.convocatorias@scrd.gov.co");
                                } else
                                {
                                    if (result == 'acceso_denegado')
                                    {
                                        notify("danger", "remove", "Usuario:", "No tiene permisos para editar información.");
                                    } else
                                    {
                                        if (isNaN(result))
                                        {
                                            notify("danger", "ok", "Convocatorias:", "Se registro un error, comuníquese con la mesa de ayuda soporte.convocatorias@scrd.gov.co");
                                        } else
                                        {
                                            notify("info", "ok", "Convocatorias:", "Se edito el perfil de participante con éxito.");
                                            $("#id_cp").attr('value','');
                                            $("#descripcion_cp").jqteVal('');
                                            $("#tipo_participante_cp").html('');
                                            cargar_tabla_perfiles_participante(token_actual);
                                        }
                                    }
                                }
                            });
                        }
                        else
                        {
                            notify("danger", "ok", "Convocatorias:", "No ha seleccionado ningun perfil del participante");
                        }                                                                                                                        
                    });
                    

                    validator_form(token_actual);
                    $(".check_activar_t").attr("checked", "true"); 
                }                
            });
            
            function validator_form(token_actual) {
                //Validar el formulario
                $('.form_nuevo_convocatoria').bootstrapValidator({
                    feedbackIcons: {
                        valid: 'glyphicon glyphicon-ok',
                        invalid: 'glyphicon glyphicon-remove',
                        validating: 'glyphicon glyphicon-refresh'
                    },
                    fields: {
                        nombre: {
                            validators: {
                                notEmpty: {message: 'El nombre de la convocatoria es requerido'}
                            }
                        },
                        descripcion: {
                            validators: {
                                notEmpty: {message: 'La descripción corta de la convocatoria es requerida'}
                            }
                        },
                    }
                }).on('success.form.bv', function (e) {
                    // Prevent form submission
                    e.preventDefault();
                    // Get the form instance
                    var $form = $(e.target);

                    // Get the BootstrapValidator instance
                    var bv = $form.data('bootstrapValidator');

                    //Se realiza la peticion con el fin de guardar el registro actual
                    $.ajax({
                        type: 'POST',
                        url: url_pv + 'Convocatorias/new_categoria',
                        data: $form.serialize() + "&modulo=Convocatorias&token=" + token_actual.token
                    }).done(function (result) {

                        if (result == 'error')
                        {
                            notify("danger", "ok", "Convocatorias:", "Se registro un error, comuníquese con la mesa de ayuda soporte.convocatorias@scrd.gov.co");
                        } else
                        {
                            if (result == 'acceso_denegado')
                            {
                                notify("danger", "remove", "Usuario:", "No tiene permisos para editar información.");
                            } else
                            {
                                if (isNaN(result)) {
                                    notify("danger", "ok", "Convocatorias:", "Se registro un error, comuníquese con la mesa de ayuda soporte.convocatorias@scrd.gov.co");
                                } else
                                {
                                    notify("success", "ok", "Convocatorias:", "Se creó el area con éxito.");
                                    //Cargar datos de la tabla de categorias
                                    cargar_tabla(token_actual);
                                }
                            }
                        }

                    });
                    
                    $form.bootstrapValidator('disableSubmitButtons', false).bootstrapValidator('resetForm', true);
                    bv.resetForm();
                });
                
                //Validar el formulario de editar la categoria
                $('.form_edit_convocatoria').bootstrapValidator({
                    feedbackIcons: {
                        valid: 'glyphicon glyphicon-ok',
                        invalid: 'glyphicon glyphicon-remove',
                        validating: 'glyphicon glyphicon-refresh'
                    },
                    fields: {
                        nombre: {
                            validators: {
                                notEmpty: {message: 'El nombre de la convocatoria es requerido'}
                            }
                        },
                        descripcion: {
                            validators: {
                                notEmpty: {message: 'La descripción corta de la convocatoria es requerida'}
                            }
                        },
                        tipo_estimulo: {
                            validators: {
                                notEmpty: {message: 'El tipo de estímulo es requerido'}
                            }
                        },                                        
                        valor_total_estimulos: {
                            validators: {
                                notEmpty: {message: 'El valor total de recursos que entregará la convocatoria es requerido'},
                                numeric: {message: 'Debe ingresar solo numeros'}
                            }
                        },                                        
                        numero_estimulos: {
                            validators: {                                                
                                numeric: {message: 'Debe ingresar solo numeros'}
                            }
                        }
                    }
                }).on('success.form.bv', function (e) {
                    // Prevent form submission
                    e.preventDefault();
                    // Get the form instance
                    var $form = $(e.target);

                    // Get the BootstrapValidator instance
                    var bv = $form.data('bootstrapValidator');

                    //Se realiza la peticion con el fin de guardar el registro actual
                    $.ajax({
                        type: 'POST',
                        url: url_pv + 'Convocatorias/new_categoria',
                        data: $form.serialize() + "&modulo=Convocatorias&token=" + token_actual.token
                    }).done(function (result) {

                        if (result == 'error')
                        {
                            notify("danger", "ok", "Convocatorias:", "Se registro un error, comuníquese con la mesa de ayuda soporte.convocatorias@scrd.gov.co");
                        } else
                        {
                            if (result == 'acceso_denegado')
                            {
                                notify("danger", "remove", "Usuario:", "No tiene permisos para editar información.");
                            } else
                            {
                                if (isNaN(result)) {
                                    notify("danger", "ok", "Convocatorias:", "Se registro un error, comuníquese con la mesa de ayuda soporte.convocatorias@scrd.gov.co");
                                } else
                                {
                                    notify("success", "ok", "Convocatorias:", "Se creó el area con éxito.");
                                    //Cargar datos de la tabla de categorias
                                    cargar_tabla(token_actual);
                                }
                            }
                        }

                    });
                    
                    $form.bootstrapValidator('disableSubmitButtons', false).bootstrapValidator('resetForm', true);
                    bv.resetForm();
                });
                
                //Validar el formulario de la bolsa
                $('.form_validator_bolsa').bootstrapValidator({
                    feedbackIcons: {
                        valid: 'glyphicon glyphicon-ok',
                        invalid: 'glyphicon glyphicon-remove',
                        validating: 'glyphicon glyphicon-refresh'
                    },
                    fields: {
                        orden: {
                            validators: {
                                notEmpty: {message: 'El número de estímulos a otorgar es requerido'},
                                numeric: {message: 'Debe ingresar solo numeros'}
                            }
                        },                                        
                        valor_recurso: {
                            validators: {
                                notEmpty: {message: 'El valor individual por estímulo es requerido'},
                                numeric: {message: 'Debe ingresar solo numeros'}
                            }
                        }                                       
                    }
                }).on('success.form.bv', function (e) {
                    // Prevent form submission
                    e.preventDefault();
                    // Get the form instance
                    var $form = $(e.target);

                    // Get the BootstrapValidator instance
                    var bv = $form.data('bootstrapValidator');

                    // Enviar datos del formulario para guardar
                    if ($("#id_bolsa").val() == "") {
                        //Se realiza la peticion con el fin de guardar el registro actual
                        $.ajax({
                            type: 'POST',
                            url: url_pv + 'Convocatoriasrecursos/new/',
                            data: $form.serialize() + "&modulo=Convocatorias&token=" + token_actual.token+"&convocatoria=" + $("#id_categoria").attr('value')
                        }).done(function (result) {

                            if (result == 'error')
                            {
                                notify("danger", "ok", "Convocatoria recurso:", "Se registro un error, comuníquese con la mesa de ayuda soporte.convocatorias@scrd.gov.co");
                            } else
                            {
                                if (result == 'acceso_denegado')
                                {
                                    notify("danger", "remove", "Usuario:", "No tiene permisos para editar información.");
                                } 
                                else
                                {
                                    if (isNaN(result)) {
                                        notify("danger", "ok", "Convocatoria recurso:", "Se registro un error, comuníquese con la mesa de ayuda soporte.convocatorias@scrd.gov.co");
                                    } 
                                    else
                                    {
                                        notify("success", "ok", "Convocatoria recurso:", "Se creó el registro con éxito.");
                                        cargar_tabla_registros(token_actual,'tbody_distribuciones_bolsas','Bolsa');
                                    }                                                    
                                }
                            }

                        });
                    } else {
                        //Realizo la peticion con el fin de editar el registro actual
                        $.ajax({
                            type: 'PUT',
                            url: url_pv + 'Convocatoriasrecursos/edit/' + $("#id_bolsa").attr('value'),
                            data: $form.serialize() + "&modulo=Convocatorias&token=" + token_actual.token
                        }).done(function (result) {
                            if (result == 'error')
                            {
                                notify("danger", "ok", "Convocatoria recurso:", "Se registro un error, comuníquese con la mesa de ayuda soporte.convocatorias@scrd.gov.co");
                            } else
                            {
                                if (result == 'acceso_denegado')
                                {
                                    notify("danger", "remove", "Usuario:", "No tiene permisos para editar información.");
                                } else
                                {
                                    if (isNaN(result))
                                    {
                                        notify("danger", "ok", "Convocatoria recurso:", "Se registro un error, comuníquese con la mesa de ayuda soporte.convocatorias@scrd.gov.co");
                                    } else
                                    {
                                        notify("info", "ok", "Convocatoria recurso:", "Se edito el registro con éxito.");
                                        cargar_tabla_registros(token_actual,'tbody_distribuciones_bolsas','Bolsa');
                                    }
                                }
                            }
                        });
                    }

                    //Elimino contenido del formulario
                    $("#id_bolsa").attr("value","");                                    
                    $form.bootstrapValidator('disableSubmitButtons', false).bootstrapValidator('resetForm', true);
                    bv.resetForm();
                });

                //Validar el formulario de la especie
                $('.form_validator_especie').bootstrapValidator({
                    feedbackIcons: {
                        valid: 'glyphicon glyphicon-ok',
                        invalid: 'glyphicon glyphicon-remove',
                        validating: 'glyphicon glyphicon-refresh'
                    },
                    fields: {
                        orden: {
                            validators: {
                                notEmpty: {message: 'El orden es requerido'},
                                numeric: {message: 'Debe ingresar solo numeros'}
                            }
                        },
                        recurso_no_pecuniario: {
                            validators: {
                                notEmpty: {message: 'El tipo de estímulo no pecuniario es requerido'}
                            }
                        },
                        valor_recurso: {
                            validators: {
                                notEmpty: {message: 'La valoración del recurso no pecuniario es requerido'},
                                numeric: {message: 'Debe ingresar solo numeros'}
                            }
                        },
                        descripcion_recurso: {
                            validators: {
                                notEmpty: {message: 'La descripción del recurso no pecuniario es requerida'}
                            }
                        }                                       
                    }
                }).on('success.form.bv', function (e) {
                    // Prevent form submission
                    e.preventDefault();
                    // Get the form instance
                    var $form = $(e.target);

                    // Get the BootstrapValidator instance
                    var bv = $form.data('bootstrapValidator');

                    // Enviar datos del formulario para guardar
                    if ($("#id_especie").val() == "") {
                        //Se realiza la peticion con el fin de guardar el registro actual
                        $.ajax({
                            type: 'POST',
                            url: url_pv + 'Convocatoriasrecursos/new/',
                            data: $form.serialize() + "&modulo=Convocatorias&token=" + token_actual.token+"&convocatoria=" + $("#id_categoria").attr('value')
                        }).done(function (result) {

                            if (result == 'error')
                            {
                                notify("danger", "ok", "Convocatoria recurso:", "Se registro un error, comuníquese con la mesa de ayuda soporte.convocatorias@scrd.gov.co");
                            } else
                            {
                                if (result == 'acceso_denegado')
                                {
                                    notify("danger", "remove", "Usuario:", "No tiene permisos para editar información.");
                                } 
                                else
                                {
                                    if (isNaN(result)) {
                                        notify("danger", "ok", "Convocatoria recurso:", "Se registro un error, comuníquese con la mesa de ayuda soporte.convocatorias@scrd.gov.co");
                                    } 
                                    else
                                    {
                                        notify("success", "ok", "Convocatoria recurso:", "Se creó el registro con éxito.");
                                        cargar_tabla_registros(token_actual,'tbody_distribuciones_especie','Especie');
                                    }                                                    
                                }
                            }

                        });
                    } else {
                        //Realizo la peticion con el fin de editar el registro actual
                        $.ajax({
                            type: 'PUT',
                            url: url_pv + 'Convocatoriasrecursos/edit/' + $("#id_especie").attr('value'),
                            data: $form.serialize() + "&modulo=Convocatorias&token=" + token_actual.token
                        }).done(function (result) {
                            if (result == 'error')
                            {
                                notify("danger", "ok", "Convocatoria recurso:", "Se registro un error, comuníquese con la mesa de ayuda soporte.convocatorias@scrd.gov.co");
                            } else
                            {
                                if (result == 'acceso_denegado')
                                {
                                    notify("danger", "remove", "Usuario:", "No tiene permisos para editar información.");
                                } else
                                {
                                    if (isNaN(result))
                                    {
                                        notify("danger", "ok", "Convocatoria recurso:", "Se registro un error, comuníquese con la mesa de ayuda soporte.convocatorias@scrd.gov.co");
                                    } else
                                    {
                                        notify("info", "ok", "Convocatoria recurso:", "Se edito el registro con éxito.");
                                        cargar_tabla_registros(token_actual,'tbody_distribuciones_especie','Especie');
                                    }
                                }
                            }
                        });
                    }

                    //Elimino contenido del formulario
                    $("#id_especie").attr("value","");                                    
                    $form.bootstrapValidator('disableSubmitButtons', false).bootstrapValidator('resetForm', true);
                    bv.resetForm();
                });
                
            }

            function cargar_tabla(token_actual)
            {
                $('#table_categorias').DataTable({
                    "language": {
                        "url": "../../dist/libraries/datatables/js/spanish.json"
                    },
                    "processing": true,
                    "destroy": true,
                    "serverSide": true,
                    "lengthMenu": [20, 30, 40],
                    "ajax": {
                        url: url_pv + "Convocatorias/all",
                        data: {"token": token_actual.token, "convocatoria": $("#id").attr('value')}
                    },
                    "initComplete": function(settings, json) {
                        $(".check_activar_t").attr("checked", "true"); 
                        $(".check_activar_f").removeAttr("checked"); 
                        acciones_categoria(token_actual);                        
                    },
                    "columns": [
                        {"data": "nombre"},
                        {"data": "descripcion"},
                        {"data": "activar_registro"},
                        {"data": "acciones"}
                    ]
                });                                
                
            }
            
            function acciones_categoria(token_actual)
            {
                //Valido si tiene bolsa concursable                                    
                $('#tipo_estimulo').on('change', function () {
                    if ($(this).val() == 2 || $(this).val() == 3)
                    {
                        $(".class_tipo_estimulo").removeAttr("disabled");
                    } 
                    else
                    {
                        $(".class_tipo_estimulo").attr("disabled", "disabled");                                                                                        
                    }                                        

                });
                
                //Valido si tiene bolsa concursable
                $("#bolsa_concursable").on('change', function () {
                    if ($(this).val() == "true")
                    {
                        $(".class_bolsa_concursable").removeAttr("disabled");
                        $("input[name='numero_estimulos']").attr("disabled", "disabled");                                            
                        $("input[name='numero_estimulos']").val("");                                            
                    } else
                    {
                        $("input[name='numero_estimulos']").removeAttr("disabled");
                        $(".class_bolsa_concursable").attr("disabled", "disabled");                                            
                        $("#descripcion_bolsa").val("");
                    }
                });                
                
                //Limpio el formulario de los perfiles de los participantes
                $('#editar_convocatoria').on('hidden.bs.modal', function () {
                    $("#id_cp").attr('value','');
                    $("#descripcion_cp").jqteVal('');
                    $("#tipo_participante_cp").html('');
                })
                
                //Permite realizar la carga respectiva de la categoria
                $(".btn_categoria").click(function () {                    
                    $("#id_categoria").attr('value', $(this).attr("title"));
                    $("#convocatoria").attr('value', getURLParameter('id'));
                    
                    
                    //Realizo la peticion para cargar el formulario
                    $.ajax({
                        type: 'GET',
                        data: {"token": token_actual.token, "id": $(this).attr("title")},
                        url: url_pv + 'Convocatorias/search/'
                    }).done(function (data) {
                        if (data == 'error_metodo')
                        {
                            notify("danger", "ok", "Convocatorias:", "Se registro un error en el método, comuníquese con la mesa de ayuda soporte.convocatorias@scrd.gov.co");
                        } else
                        {
                            if (data == 'error')
                            {
                                notify("danger", "ok", "Convocatorias:", "El convocatoria no se encuentra registrado, por favor registrarse");
                            } else
                            {
                                var json = JSON.parse(data);

                                //Cargo los checks de quienes pueden participar
                                $('#quienes_pueden_participar').html("<label>¿Quién puede participar?</label><br/>");
                                $("#tbody_tipos_participantes").find("tr").remove();
                                if (json.tipos_participantes.length > 0) {
                                    $.each(json.tipos_participantes, function (key, tipo_participante) {
                                        var checked = '';                                                        
                                        if (tipo_participante.active == true)
                                        {
                                            checked = 'checked="checked"';
                                        }                                                        

                                        $("#quienes_pueden_participar").append('<label class="checkbox-inline"><input class="tipo_participante tipo_participante_' + tipo_participante.id + '" value="' + tipo_participante.id + '" type="checkbox" '+checked+'>' + tipo_participante.nombre + '</label>');

                                        if (tipo_participante.descripcion == null)
                                        {
                                            tipo_participante.descripcion  = '';
                                        }

                                        $("#tbody_tipos_participantes").append('<tr><td>' + tipo_participante.nombre + '</td><td><input class="activo_participante_'+tipo_participante.id+'" onclick="activar_participante('+tipo_participante.id+','+$("#id").attr('value')+',\''+token_actual.token+'\')" type="checkbox" '+checked+'></td><td><button type="button" class="btn btn-warning btn-update-convocatoria-participante" lang="'+JSON.stringify(tipo_participante).replace(/\"/g,"&quot;")+'"><span class="glyphicon glyphicon-edit"></span></button></td></tr>');
                                    });
                                }
                                
                                //Cargo los perfiles de los jurados en esta convocatoria
                                if (json.perfiles_jurados.length > 0) {
                                    $.each(json.perfiles_jurados, function (key, perfil_jurado) {
                                        var checked = '';
                                        if (perfil_jurado.active == true)
                                        {
                                            checked="checked='checked'";
                                        }                                                                                                                                                                                                                                
                                        $("#tbody_perfiles_jurados").append('<tr><td>' + perfil_jurado.orden + '</td><td>' + perfil_jurado.descripcion_perfil + '</td><td><input onclick="activar_perfil_jurado('+perfil_jurado.id+','+$("#id").attr('value')+',\''+token_actual.token+'\')" type="checkbox" '+checked+'></td><td><button type="button" class="btn btn-warning btn-update-convocatoria-jurados-'+perfil_jurado.id+'" onclick="cargar_perfil_jurado('+perfil_jurado.id+')" lang="'+JSON.stringify(perfil_jurado).replace(/\"/g,"&quot;")+'"><span class="glyphicon glyphicon-edit"></span></button></td></tr>');
                                    });
                                }

                                //Cargo los la distribucion de bolsas
                                $("#tbody_distribuciones_bolsas").find("tr").remove();
                                if (json.distribuciones_bolsas.length > 0) {
                                    $.each(json.distribuciones_bolsas, function (key, distribucion_bolsa) {
                                        var checked = '';
                                        if (distribucion_bolsa.active == true)
                                        {
                                            checked="checked='checked'";
                                        }                                                                                                                                                                                                                                
                                        $("#tbody_distribuciones_bolsas").append('<tr><td>' + distribucion_bolsa.orden + '</td><td>' + distribucion_bolsa.valor_recurso + '</td><td><input onclick="activar_registro('+distribucion_bolsa.id+',\''+token_actual.token+'\')" type="checkbox" '+checked+'></td><td><button type="button" class="btn btn-warning btn-update-distribucion-registro-'+distribucion_bolsa.id+'" onclick="cargar_registro('+distribucion_bolsa.id+',\'form_validator_bolsa\')" lang="'+JSON.stringify(distribucion_bolsa).replace(/\"/g,"&quot;")+'"><span class="glyphicon glyphicon-edit"></span></button></td></tr>');
                                    });
                                }

                                //Cargo los la distribucion de especies
                                $("#tbody_distribuciones_especie").find("tr").remove();
                                if (json.distribuciones_especies.length > 0) {
                                    $.each(json.distribuciones_especies, function (key, distribucion_especie) {
                                        var checked = '';
                                        if (distribucion_especie.active == true)
                                        {
                                            checked="checked='checked'";
                                        }                                                                                                                                                                                                                                
                                        $("#tbody_distribuciones_especie").append('<tr><td>' + distribucion_especie.orden + '</td><td>' + distribucion_especie.recurso_no_pecuniario + '</td><td>' + distribucion_especie.valor_recurso + '</td><td><input onclick="activar_registro('+distribucion_especie.id+',\''+token_actual.token+'\')" type="checkbox" '+checked+'></td><td><button type="button" class="btn btn-warning btn-update-distribucion-registro-'+distribucion_especie.id+'" onclick="cargar_registro('+distribucion_especie.id+',\'form_validator_especie\')" lang="'+JSON.stringify(distribucion_especie).replace(/\"/g,"&quot;")+'"><span class="glyphicon glyphicon-edit"></span></button></td></tr>');
                                    });
                                }

                                //para habilitar formulario de convocatoria participante
                                $(".btn-update-convocatoria-participante").click(function () {
                                    var json_update = JSON.parse($(this).attr("lang"));
                                    $("#id_cp").val(json_update.id_cp);
                                    $("#tipo_participante_cp").html(json_update.nombre);
                                    $("#descripcion_cp").jqteVal(json_update.descripcion_cp);
                                });

                                //Creamos los participantes en la convocatoria
                                $('.tipo_participante').click(function () {
                                    var tipo_participante = $(this).val();
                                    if( $(this).prop('checked') ) {                                                        
                                        //Se realiza la peticion con el fin de guardar el registro de la convocatoria participante
                                        $.ajax({
                                            type: 'POST',
                                            url: url_pv + 'Convocatoriasparticipantes/new/',
                                            data: "convocatoria="+$("#id_categoria").val()+"&tipo_participante="+$(this).val()+"&modulo=Convocatorias&token=" + token_actual.token
                                        }).done(function (result) {

                                            if (result == 'error')
                                            {
                                                notify("danger", "ok", "Convocatorias:", "Se registro un error, comuníquese con la mesa de ayuda soporte.convocatorias@scrd.gov.co");                                                                
                                            } else
                                            {
                                                if (result == 'acceso_denegado')
                                                {
                                                    notify("danger", "remove", "Convocatorias:", "No tiene permisos para editar información.");
                                                } else
                                                {
                                                    if (isNaN(result)) {
                                                        notify("danger", "ok", "Convocatorias:", "Se registro un error, comuníquese con la mesa de ayuda soporte.convocatorias@scrd.gov.co");
                                                    } else
                                                    {
                                                        notify("success", "ok", "Convocatorias:", "Se creó el perfil del participante con éxito.");
                                                        $(".activo_participante_"+tipo_participante).attr('checked', true);
                                                        $(".activo_participante_"+tipo_participante).prop( "checked", true );
                                                    }
                                                }
                                            }

                                        });
                                    }
                                    else
                                    {
                                        //Se realiza la peticion para desactivar la convocatoria participante
                                        $.ajax({
                                            type: 'DELETE',
                                            data: {"token": token_actual.token,"modulo":"Convocatorias","convocatoria":$("#id_categoria").val(),"tipo_participante":$(this).val()},
                                            url: url_pv+'Convocatoriasparticipantes/delete'                  
                                        }).done(function (data) {    
                                            if (data == 'Si' || data == 'No')
                                            {
                                                if (data == 'Si')
                                                {
                                                    notify("info", "ok", "Convocatorias:", "Se activo el perfil del participante con éxito.");                                        
                                                    $(".activo_participante_"+tipo_participante).attr('checked', true);
                                                    $(".activo_participante_"+tipo_participante).prop( "checked", true );
                                                }
                                                else
                                                {
                                                    notify("info", "ok", "Convocatorias:", "Se elimino el perfil del participante con éxito.");                                        
                                                    $(".activo_participante_"+tipo_participante).attr('checked', false);
                                                    $(".activo_participante_"+tipo_participante).prop( "checked", false );
                                                }  
                                            }
                                            else
                                            {
                                                if (data == 'acceso_denegado')
                                                {
                                                    notify("danger", "remove", "Convocatorias:", "Acceso denegado.");
                                                }
                                                else
                                                {
                                                    notify("danger", "ok", "Convocatorias:", "Se registro un error en el método, comuníquese con la mesa de ayuda soporte.convocatorias@scrd.gov.co");
                                                }
                                            }
                                        });
                                    }
                                });

                                //Cargo el select de los recursos no pecuniarios
                                $('#recurso_no_pecuniario').find('option').remove();
                                $("#recurso_no_pecuniario").append('<option value="">:: Seleccionar ::</option>');
                                if (json.recursos_no_pecunarios.length > 0) {
                                    $.each(json.recursos_no_pecunarios, function (key, recurso_no_pecuniario) {
                                        $("#recurso_no_pecuniario").append('<option value="' + recurso_no_pecuniario.id + '" >' + recurso_no_pecuniario.nombre + '</option>');
                                    });
                                }

                                //Cargo el select de tipos de estimulos
                                $('#tipo_estimulo').find('option').remove();
                                $("#tipo_estimulo").append('<option value="">:: Seleccionar ::</option>');
                                if (json.tipos_estimulos.length > 0) {
                                    $.each(json.tipos_estimulos, function (key, tipo_estimulo) {
                                        var selected = '';
                                        if (tipo_estimulo.id == json.convocatoria.tipo_estimulo)
                                        {
                                            selected = 'selected="selected"';
                                        }
                                        $("#tipo_estimulo").append('<option value="' + tipo_estimulo.id + '" ' + selected + ' >' + tipo_estimulo.nombre + '</option>');
                                    });
                                }

                                //Habilito los modales dependiendo del tipo de estimulo
                                if ($("#tipo_estimulo").val() == 2 || $("#tipo_estimulo").val() == 3)
                                {
                                    $(".class_tipo_estimulo").removeAttr("disabled");
                                } else
                                {
                                    $(".class_tipo_estimulo").attr("disabled", "disabled");                                                                                        
                                }

                                //Habilito los modales dependiendo del tipo de estimulo
                                if ($("#tipo_estimulo").val() == 2)
                                {
                                    $(".class_bolsa_concursable").attr("disabled", "disabled");                                                                                                                                    
                                } 
                                else
                                {
                                    $(".class_bolsa_concursable").removeAttr("disabled");
                                }

                                $('#form_edit_convocatoria').loadJSON(json.convocatoria);

                                //Se realiza este set debido a que los boolean no lo toma con load json
                                $("#seudonimo option[value='"+json.convocatoria.seudonimo+"']").prop('selected', true);
                                $("#bolsa_concursable option[value='"+json.convocatoria.bolsa_concursable+"']").prop('selected', true);
                                //Verifico si es bolsa concursable
                                if ($("#bolsa_concursable").val() == "true")
                                {
                                    $(".class_bolsa_concursable").removeAttr("disabled");
                                    $("input[name='numero_estimulos']").attr("disabled", "disabled");                                                                                                
                                    $("input[name='numero_estimulos']").val("");
                                } 
                                else
                                {
                                    $(".class_bolsa_concursable").attr("disabled", "disabled");                                            
                                    $("input[name='numero_estimulos']").removeAttr("disabled");                                                    
                                    $("#descripcion_bolsa").val("");
                                }

                                //Se realiza este set en cada text area html debido a que jste no es compatible con load json
                                $("#descripcion").jqteVal(json.convocatoria.descripcion);                                

                            }
                        }
                    });
                    
                    
                });
                
                //Permite activar o eliminar una categoria
                $(".activar_categoria").click(function () {
                    
                    var active = "false";
                    if( $(this).prop('checked') ) {
                        active = "true";
                    }
                    
                    
                    $.ajax({
                        type: 'DELETE',
                        data: {"token": token_actual.token, "modulo": "Convocatorias","active":active},
                        url: url_pv + 'Convocatorias/delete_categoria/' + $(this).attr("title")
                    }).done(function (data) {
                        if (data == 'ok')
                        {
                            if(active=="true")
                            {
                                notify("info", "ok", "Convocatorias:", "Se activo la categoría con éxito.");                            
                            }
                            else
                            {
                                notify("info", "ok", "Convocatorias:", "Se elimino el categoría con éxito.");                            
                            }
                        } 
                        else
                        {
                            if (data == 'acceso_denegado')
                            {
                                notify("danger", "remove", "Convocatorias:", "Acceso denegado.");
                            } else
                            {
                                notify("danger", "ok", "Convocatorias:", "Se registro un error en el método, comuníquese con la mesa de ayuda soporte.convocatorias@scrd.gov.co");
                            }
                        }
                    });
                });
            }
            
            //Carga la tabla de los recursos de la convocatoria
            function cargar_tabla_registros(token_actual,tbody,tipo_recurso){
                $.ajax({
                    type: 'GET',
                    data: {"token": token_actual.token,"convocatoria":$("#id_categoria").val(),"tipo_recurso":tipo_recurso},
                    url: url_pv + 'Convocatoriasrecursos/select_convocatoria'
                }).done(function (data) {
                    if (data == 'error_metodo')
                    {
                        notify("danger", "ok", "Usuarios:", "Se registro un error en el método, comuníquese con la mesa de ayuda soporte.convocatorias@scrd.gov.co");
                    } else
                    {
                        if (data == 'error')
                        {
                            notify("danger", "ok", "Usuarios:", "El usuario no se encuentra registrado, por favor registrarse");
                        } else
                        {
                            var json = JSON.parse(data);
                            if (json.length > 0) {
                                $("#"+tbody).find("tr").remove();
                                $.each(json, function (key, distribucion_bolsa) {                                                        
                                    var checked = '';
                                    if (distribucion_bolsa.active == true)
                                    {
                                        checked="checked='checked'";
                                    }    

                                    if(tipo_recurso=="Bolsa")
                                    {

                                        $("#"+tbody).append('<tr><td>' + distribucion_bolsa.orden + '</td><td>' + distribucion_bolsa.valor_recurso + '</td><td><input onclick="activar_registro('+distribucion_bolsa.id+',\''+token_actual.token+'\')" type="checkbox" '+checked+'></td><td><button type="button" class="btn btn-warning btn-update-distribucion-registro-'+distribucion_bolsa.id+'" onclick="cargar_registro('+distribucion_bolsa.id+',\'form_validator_bolsa\')" lang="'+JSON.stringify(distribucion_bolsa).replace(/\"/g,"&quot;")+'"><span class="glyphicon glyphicon-edit"></span></button></td></tr>');
                                    }
                                    else
                                    {
                                        $("#"+tbody).append('<tr><td>' + distribucion_bolsa.orden + '</td><td>' + distribucion_bolsa.recurso_no_pecuniario + '</td><td>' + distribucion_bolsa.valor_recurso + '</td><td><input onclick="activar_registro('+distribucion_bolsa.id+',\''+token_actual.token+'\')" type="checkbox" '+checked+'></td><td><button type="button" class="btn btn-warning btn-update-distribucion-registro-'+distribucion_bolsa.id+'" onclick="cargar_registro('+distribucion_bolsa.id+',\'form_validator_especie\')" lang="'+JSON.stringify(distribucion_bolsa).replace(/\"/g,"&quot;")+'"><span class="glyphicon glyphicon-edit"></span></button></td></tr>');
                                    }


                                });
                            }
                        }
                    }
                });
            }
            
            //Funcion para activar o desactivar los recursos del estimulo
            function activar_registro(id,token_actual) {
                $.ajax({
                    type: 'DELETE',
                    data: {"token": token_actual,"modulo":"Convocatorias"},
                    url: url_pv+'Convocatoriasrecursos/delete/' + id                    
                }).done(function (data) {  
                    if (data == 'Si' || data == 'No')
                    {
                        if (data == 'Si')
                        {
                            notify("info", "ok", "Convocatoria recurso:", "Se activo el registro con éxito.");                                                                                    
                        }
                        else
                        {
                            notify("danger", "ok", "Convocatoria recurso:", "Se inactivo el registro con éxito.");                                                                                    
                        }  
                    }
                    else
                    {
                        if (data == 'acceso_denegado')
                        {
                            notify("danger", "remove", "Convocatorias:", "Acceso denegado.");
                        }
                        else
                        {
                            notify("danger", "ok", "Convocatorias:", "Se registro un error en el método, comuníquese con la mesa de ayuda soporte.convocatorias@scrd.gov.co");                                                                                        
                        }
                    }
                });                                                                
            }

            //Carga el registro el registro del recurso de la convocatoria
            function cargar_registro(id,form){
                var json_update = JSON.parse($(".btn-update-distribucion-registro-"+id).attr("lang"));
                $('#'+form).loadJSON(json_update);                               
            }
            
            //Funcion para activar o desactivar participante
            function activar_participante(tipo_participante,convocatoria,token_actual) {
                //Se realiza la peticion para desactivar la convocatoria participante
                $.ajax({
                    type: 'DELETE',
                    data: {"token": token_actual,"modulo":"Convocatorias","convocatoria":convocatoria,"tipo_participante":tipo_participante},
                    url: url_pv+'Convocatoriasparticipantes/delete'                  
                }).done(function (data) {  
                    if (data == 'Si' || data == 'No')
                    {
                        if (data == 'Si')
                        {
                            notify("info", "ok", "Convocatorias:", "Se activo el perfil del participante con éxito.");                                        
                            $(".tipo_participante_"+tipo_participante).attr('checked', true);
                            $(".tipo_participante_"+tipo_participante).prop( "checked", true );
                        }
                        else
                        {
                            notify("info", "ok", "Convocatorias:", "Se elimino el perfil del participante con éxito.");                                        
                            $(".tipo_participante_"+tipo_participante).attr('checked', false);
                            $(".tipo_participante_"+tipo_participante).prop( "checked", false );
                        }  
                    }
                    else
                    {
                        if (data == 'acceso_denegado')
                        {
                            notify("danger", "remove", "Convocatorias:", "Acceso denegado.");
                        }
                        else
                        {
                            notify("danger", "ok", "Convocatorias:", "Se registro un error en el método, comuníquese con la mesa de ayuda soporte.convocatorias@scrd.gov.co");                                                                                        
                        }
                    }
                });                                                                
            }
            
            //Carga la tabla de los perfiles de los participantes
            function cargar_tabla_perfiles_participante(token_actual){
                $.ajax({
                    type: 'GET',
                    data: {"token": token_actual.token,"convocatoria":$("#id_categoria").val()},
                    url: url_pv + 'Convocatoriasparticipantes/select_form_convocatoria'
                }).done(function (data) {
                    if (data == 'error_metodo')
                    {
                        notify("danger", "ok", "Usuarios:", "Se registro un error en el método, comuníquese con la mesa de ayuda soporte.convocatorias@scrd.gov.co");
                    } else
                    {
                        if (data == 'error')
                        {
                            notify("danger", "ok", "Usuarios:", "El usuario no se encuentra registrado, por favor registrarse");
                        } else
                        {
                            var json = JSON.parse(data);
                            if (json.length > 0) {
                                $("#tbody_tipos_participantes").find("tr").remove();
                                $.each(json, function (key, tipo_participante) {                                                        
                                    var checked = '';
                                    if (tipo_participante.active == true)
                                    {
                                        checked="checked='checked'";
                                    }                                                                                                                                                                                                                                                                                    
                                    $("#tbody_tipos_participantes").append('<tr><td>' + tipo_participante.nombre + '</td><td><input class="activo_participante_'+tipo_participante.id+'" onclick="activar_participante('+tipo_participante.id+','+$("#id_categoria").attr('value')+',\''+token_actual.token+'\')" type="checkbox" '+checked+'></td><td><button type="button" class="btn btn-warning btn-update-convocatoria-participante" lang="'+JSON.stringify(tipo_participante).replace(/\"/g,"&quot;")+'"><span class="glyphicon glyphicon-edit"></span></button></td></tr>');
                                });

                                //para habilitar formulario de convocatoria participante
                                $(".btn-update-convocatoria-participante").click(function () {
                                    var json_update = JSON.parse($(this).attr("lang"));
                                    $("#id_cp").val(json_update.id_cp);
                                    $("#tipo_participante_cp").html(json_update.nombre);
                                    $("#descripcion_cp").jqteVal(json_update.descripcion_cp);
                                });
                            }
                        }
                    }
                });
            }

        </script>
    </body>
</html>